# Тестовое задание для Python разработчика Junior+ InCodeWeTrust

## Цель задания

Создать RESTful API-сервис на Python с использованием Flask, который будет предоставлять данные для создания простых графиков. Сервис должен:

* Подключаться к PostgreSQL для получения данных.
* Обрабатывать SQL-запросы для извлечения агрегированных данных.
* Предоставлять API-эндпоинты для получения данных в формате JSON.
* Реализовать CRUD-операции для категорий и продуктов.
* Использовать миграции с Alembic для управления структурой базы данных.

---

## API эндпоинты

### 1. Эндпоинты для продуктов
#### 1.1 Получить все продукты
**URL:** `/api/products`  
**Метод:** `GET`

**Описание:**  
Получает список всех продуктов.

**Ответ:**
```json
{
  "products": [
    {
      "id": 1,
      "name": "Продукт 1",
      "category_id": 1
    },
    ...
  ]
}
Статус-код 200
```

#### 1.2 Добавить новый продукт
**URL:** /api/products

**Метод:** POST

**Описание:**
Добавляет новый продукт в базу данных.

**Тело запроса (JSON):**
```json
{
  "name": "Продукт 1",
  "category_id": 1
}
```
**Ответ:**

```json
{
  "product": {
    "id": 1,
    "name": "Продукт 1",
    "category_id": 1
  }
}

Статус-код 201
```

#### 1.3 Обновить продукт
**URL:** /api/products/{id}

**Метод:** PUT

**Описание:**
Обновляет существующий продукт по его ID.

**Тело запроса (JSON):**

```json
{
  "name": "Обновленный продукт",
  "category_id": 2
}
```
**Ответ:**

```json
{
  "product": {
    "id": 1,
    "name": "Обновленный продукт",
    "category_id": 2
  }
}
Статус-код 200
```

#### 1.4 Удалить продукт
**URL:** /products/{id}

**Метод:** DELETE

**Описание:**
Удаляет продукт по его ID.

**Ответ:**

```
Статус-код 204
```

### 2. Эндпоинты для продаж
#### 2.1 Получить общую сумму продаж
**URL:** /api/sales/total

**Метод:** GET

**Описание:**
Возвращает общую сумму продаж за указанный период.

**Параметры запроса:**

* start_date: Начальная дата в формате DD-MM-YYYY.

* end_date: Конечная дата в формате DD-MM-YYYY.

**Пример запроса:**
```http
GET /sales/total?start_date=01-01-2023&end_date=31-12-2023
```
**Ответ:**
```json
{
  "cached": true,
  "total": 5000
}
Статус-код 200
```

#### 2.2 Получить топ продуктов по продажам
**URL:** /sales/top-products

**Метод:** GET

**Описание:**
Возвращает топ-N самых продаваемых товаров за указанный период.

**Параметры запроса:**

* start_date: Начальная дата в формате DD-MM-YYYY.

* end_date: Конечная дата в формате DD-MM-YYYY.

* limit: Максимальное количество возвращаемых продуктов.

**Пример запроса:**

```http
GET /sales/top-products?start_date=01-01-2023&end_date=31-12-2023&limit=10
```
**Ответ:**

```json
{
  "cached": false,
  "top_products": [
    {
      "product": {
        "id": 1,
        "name": "Продукт 1",
        "category_id": 1
      },
      "total_sales": 500
    },
    ...
  ]
}
Статус-код 200
```

### Автор backend Артём Куликов

tg: [@Berg1005](https://t.me/berg1005)

[GitHub](https://github.com/berg96)

## Используемые технологии 

Проект использует реляционную базу данных PostgreSQL для хранения данных и реализован на языке python c использованием следующего технгологического стека:

* Flask
* python-dotenv
* SQLAlchemy
* Alembic
* Gunicorn

## Как запустить проект

Клонировать репозиторий:
```
git clone https://github.com/berg96/product_sales_testtask_InCodeWeTrust.git
```
Перейти в него в командной строке:
```
cd product_sales_testtask_InCodeWeTrust
```
Создать файл .env с актуальными переменными окружения по примеру .env_example
Запустить Docker compose:
```
docker compose up -d
```
Применить миграции и наполнить БД тестовыми данными:
```
docker compose exec app alembic upgrade head
```
